import {call, put, delay} from 'redux-saga/effects'

import {planetsApi} from "services/axios";
import {SagaIterator} from "@redux-saga/types";
import {fetchNewPlanetsPageSuccess, putPlanetDataForComparison} from "components/charts/planets-comparison/actions";


const fetchPlanets = (arg: any) => {
   //@ts-ignore
    let planetsArray = arg.payload.map((item) => {
        return planetsApi.getPlanet(item)
    });

    return Promise.all(planetsArray);
}

export function* planetsForComparisonWorker(arg: any): SagaIterator {

    let planets = yield call(fetchPlanets, arg)
    yield put(putPlanetDataForComparison(planets))
    yield delay(3000)
    yield put(fetchNewPlanetsPageSuccess())

}

