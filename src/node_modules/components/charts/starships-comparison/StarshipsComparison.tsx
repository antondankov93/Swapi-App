import React from "react";
import s from './starshipsComparison.module.scss'
import {Button, OverlayTrigger, Pagination, Tooltip} from "react-bootstrap";
import {useShipsComparison} from "components/charts/starships-comparison/hooks/useShipsComparison";
import {NavLink} from "react-router-dom";

export const StarshipsComparison = () => {

    const {
        getNextShipsPage, isLoading, currentPage, addItemToComparison,
        countAllShips, shipsList, shipsForComparison, removeItemToComparison, startComparison, deleteAllItemsToComparison
    } = useShipsComparison()
    // @ts-ignore
    let pagesCount = Math.ceil(countAllShips / shipsList?.length);
    //@ts-ignore
    let pages = [];
    for (let i = 1; i <= pagesCount; i++) {
        pages.push(i);
    }


    return (
        <div className={s.mainWrapper}>
            <div className={s.shipsComparisonCounter}>
                <p>Added to comparison <span>{shipsForComparison.length}</span></p>
                {shipsForComparison.length >= 2 ?
                    <div className={s.comparisonButtons}>
                    <NavLink to="/charts/starships-comparison" onClick={() => startComparison(shipsForComparison)}>Compare</NavLink>
                    <Button size='sm' variant='outline-danger' onClick={deleteAllItemsToComparison}>clear &#128465;</Button>
                    </div> : ''}
            </div>

            <section className={s.listWrapper}>
                {shipsList.map((p: { name: React.ReactNode; url: { match: (arg0: RegExp) => number[]; }; }) =>
                    <div className={s.listItem}>
                        <p className={s.listHeader}>
                            <span>{p.name}</span>
                            <OverlayTrigger
                                overlay={
                                    <Tooltip id={`tooltip`}>
                                        add to comparison
                                    </Tooltip>
                                }
                            >
                                <Button className={s.buttonAddRemove}
                                        onClick={() => {
                                        shipsForComparison.find(s => s === +p.url.match(/\/([0-9]*)\/$/)[1])
                                        ? removeItemToComparison(+p.url.match(/\/([0-9]*)\/$/)[1])
                                        : addItemToComparison(+p.url.match(/\/([0-9]*)\/$/)[1])
                                }}
                                        size='sm' variant="outline-warning">
                                    {shipsForComparison.find(s => s === +p.url.match(/\/([0-9]*)\/$/)[1])
                                    ? '-' : '+'}
                                </Button>
                            </OverlayTrigger>
                        </p>
                        <div className={s.listImage}>
                            <img
                                src={`https://starwars-visualguide.com/assets/img/starships/${p.url.match(/\/([0-9]*)\/$/)[1]}.jpg`}
                                alt=""/>
                        </div>
                    </div>
                )}
            </section>

            <Pagination className={s.paginator} size="sm">
                {pages.map(p =>
                    //@ts-ignore
                    <Pagination.Item className={s.paginatorItem} active={p === currentPage ? currentPage : ''}
                                     onClick={() => getNextShipsPage(p)}>
                        {p}
                    </Pagination.Item>)
                }
            </Pagination>
        </div>
    )
}