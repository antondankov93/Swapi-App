import {call, put, delay} from 'redux-saga/effects'

import {starshipsApi} from "services/axios";
import {SagaIterator} from "@redux-saga/types";
import {fetchNewShipsPageSuccess, putShipsDataForComparison} from "components/charts/starships-comparison/actions";


const fetchShips = (arg: any) => {
   //@ts-ignore
    let shipsArray = arg.payload.map((item) => {
        return starshipsApi.getStarships(item)
    });

    return Promise.all(shipsArray);
}

export function* shipsComparisonWorker(arg: any): SagaIterator {

    let ships = yield call(fetchShips, arg)
    yield put(putShipsDataForComparison(ships))
    yield delay(3000)
    yield put(fetchNewShipsPageSuccess())

}

