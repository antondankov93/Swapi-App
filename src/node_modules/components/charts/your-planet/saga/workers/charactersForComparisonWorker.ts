import {call, put} from 'redux-saga/effects'

import {charactersApi} from "services/axios";
import {SagaIterator} from "@redux-saga/types";
import {putShipsDataForComparison} from "components/charts/starships-comparison/actions";
import {fetchNewYourPlanetPageSuccess} from "components/charts/your-planet/actions";


const fetchShips = (arg: any) => {
   //@ts-ignore
    let charactersArray = arg.payload.map((item) => {
        return charactersApi.getCharacter(item)
    });

    return Promise.all(charactersArray);
}

export function* charactersForComparisonWorker(arg: any): SagaIterator {

    let ships = yield call(fetchShips, arg)
    yield put(putShipsDataForComparison(ships))

    yield put(fetchNewYourPlanetPageSuccess())

}

