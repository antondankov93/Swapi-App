import React from "react";
import s from './yourPlanet.module.scss'
import {Button, OverlayTrigger, Pagination, Tooltip} from "react-bootstrap";
import {useYourPlanet} from "components/charts/your-planet/hooks/useYourPlanet";

export const YourPlanet = () => {

    const {currentPage, charactersList, isLoading, countAllCharacters, charactersForComparison,
        getNextYourPlanetPage, addItemToComparison, removeItemToComparison,
        deleteAllItemsToComparison, startComparison} = useYourPlanet()

    // @ts-ignore
    let pagesCount = Math.ceil(countAllCharacters / charactersList?.length);
    //@ts-ignore
    let pages = [];
    for (let i = 1; i <= pagesCount; i++) {
        pages.push(i);
    }


    return (
        <div className={s.mainWrapper}>
            <div className={s.shipsComparisonCounter}>
                <p>Added to comparison <span>{charactersForComparison.length}</span></p>
                {charactersForComparison.length >= 2 ?
                    <div className={s.comparisonButtons}>
                    <a href="#" onClick={() => startComparison(charactersForComparison)}>Compare</a>
                    <Button size='sm' variant='outline-danger' onClick={deleteAllItemsToComparison}>clear &#128465;</Button>
                </div> : ''}
            </div>

            <section className={s.listWrapper}>
                {charactersList.map((p: { name: React.ReactNode; url: { match: (arg0: RegExp) => number[]; }; }) =>
                    <div className={s.listItem}>
                        <p className={s.listHeader}>
                            <span>{p.name}</span>
                            <OverlayTrigger
                                overlay={
                                    <Tooltip id={`tooltip`}>
                                        add to comparison
                                    </Tooltip>
                                }
                            >
                                <Button className={s.buttonAddRemove}
                                        onClick={() => {
                                            charactersForComparison.find(s => s === +p.url.match(/\/([0-9]*)\/$/)[1])
                                                ? removeItemToComparison(+p.url.match(/\/([0-9]*)\/$/)[1])
                                                : addItemToComparison(+p.url.match(/\/([0-9]*)\/$/)[1])
                                        }}
                                        size='sm' variant="outline-warning">
                                    {charactersForComparison.find(s => s === +p.url.match(/\/([0-9]*)\/$/)[1])
                                        ? '-' : '+'}
                                </Button>
                            </OverlayTrigger>
                        </p>
                        <div className={s.listImage}>
                            <img
                                src={`https://starwars-visualguide.com/assets/img/characters/${p.url.match(/\/([0-9]*)\/$/)[1]}.jpg`}
                                alt=""/>
                        </div>
                    </div>
                )}
            </section>

            <Pagination className={s.paginator} size="sm">
                {pages.map(p =>
                    //@ts-ignore
                    <Pagination.Item className={s.paginatorItem} active={p === currentPage ? currentPage : ''}
                                     onClick={() => getNextYourPlanetPage(p)}>
                        {p}
                    </Pagination.Item>)
                }
            </Pagination>
        </div>
    )
}