import React from "react";
import s from './planetsPopulation.module.scss'
import {usePlanetPopulation} from "components/charts/planets-population/hooks/usePlanetsPopulation";
import {Button, OverlayTrigger, Pagination, Tooltip} from "react-bootstrap";
import {NavLink} from "react-router-dom";

export const PlanetsPopulation = () => {

    const {
        getNextPage, isLoading, currentPage, countAllPlanets, planetsList, addItemToComparison,
        removeItemToComparison, planetsForComparison, startComparison, deleteAllItemsToComparison
    } = usePlanetPopulation()
    // @ts-ignore
    let pagesCount = Math.ceil(countAllPlanets / planetsList?.length);
    //@ts-ignore
    let pages = [];
    for (let i = 1; i <= pagesCount; i++) {
        pages.push(i);
    }


    return (
        <div className={s.mainWrapper}>
            <div className={s.shipsComparisonCounter}>
                <p>Added to comparison <span>{planetsForComparison.length}</span></p>
                {planetsForComparison.length >= 2
                    ? <div className={s.comparisonButtons}>
                        <NavLink to='/charts/planets-comparison' onClick={() => startComparison(planetsForComparison)}>Compare</NavLink>
                        <Button size='sm' variant='outline-danger' onClick={deleteAllItemsToComparison}>clear &#128465;</Button>
                      </div>
                    : ''}
            </div>

            <section className={s.listWrapper}>
                {planetsList.map((p: { name: React.ReactNode; url: { match: (arg0: RegExp) => number[]; }; }) =>
                    <div className={s.listItem}>
                        <p className={s.listHeader}>
                            <span>{p.name}</span>
                            <OverlayTrigger
                                overlay={
                                    <Tooltip id={`tooltip`}>
                                        add to comparison
                                    </Tooltip>
                                }
                            >
                                <Button className={s.buttonAddRemove}
                                        onClick={() => {
                                            //@ts-ignore
                                            planetsForComparison.find(s => s === +p.url.match(/\/([0-9]*)\/$/)[1])
                                                ? removeItemToComparison(+p.url.match(/\/([0-9]*)\/$/)[1])
                                                : addItemToComparison(+p.url.match(/\/([0-9]*)\/$/)[1])
                                        }}
                                        size='sm' variant="outline-warning">

                                    {planetsForComparison.find(
                                        //@ts-ignore
                                        s => s === +p.url.match(/\/([0-9]*)\/$/)[1])
                                        ? '-' : '+'}
                                </Button>
                            </OverlayTrigger>
                        </p>
                        <div className={s.listImage}>
                            <img
                                src={`https://starwars-visualguide.com/assets/img/planets/${p.url.match(/\/([0-9]*)\/$/)[1]}.jpg`}
                                alt=""/>
                        </div>
                    </div>
                )}
            </section>

            <Pagination className={s.paginator} size="sm">
                {pages.map(p =>
                    //@ts-ignore
                    <Pagination.Item className={s.paginatorItem} active={p === currentPage ? currentPage : ''}
                                     onClick={() => getNextPage(p)}>
                        {p}
                    </Pagination.Item>)
                }
            </Pagination>
        </div>
    )
}